<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0"/>
  <title>Bloomie HK ğŸŒ¸</title>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet"/>

  <!-- CSV è§£æå™¨ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --gold:#c9a84c;--gold-light:#f0d080;--gold-dark:#9a7a2e;
      --cream:#fdf8f0;--deep-brown:#3d2b1f;--medium-brown:#7a5c3e;
      --light-brown:#b8936a;--bg-dark:#1a0f00;--phone-max:430px;
    }
    html,body{height:100%;font-family:'Noto Sans TC',sans-serif;background:var(--bg-dark);overflow-x:hidden}
    body::before{
      content:'';position:fixed;inset:0;z-index:0;
      background:radial-gradient(ellipse at 20% 50%,rgba(201,168,76,.07),transparent 50%),
                 radial-gradient(ellipse at 80% 50%,rgba(201,168,76,.07),transparent 50%),
                 linear-gradient(180deg,#0d0700,#1a0f00 40%,#0d0700);
    }
    #app{
      position:relative;z-index:1;width:100%;max-width:var(--phone-max);
      min-height:100vh;margin:0 auto;display:flex;flex-direction:column;
      background:var(--cream);overflow:hidden;
    }

    /* â”€â”€ LOADING â”€â”€ */
    #loading-screen{
      position:fixed;inset:0;z-index:9999;
      background:linear-gradient(180deg,#1a0800,#2d1500 50%,#1a0800);
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      max-width:var(--phone-max);margin:0 auto;left:50%;transform:translateX(-50%);
      width:100%;transition:opacity .8s ease;
    }
    #loading-screen.fade-out{opacity:0;pointer-events:none}
    .lotus-spin{width:110px;height:110px;animation:lspin 5s linear infinite;margin-bottom:22px}
    @keyframes lspin{to{transform:rotate(360deg)}}
    .loading-mantra{
      font-family:'Noto Serif TC',serif;font-size:25px;font-weight:900;
      color:var(--gold);letter-spacing:8px;margin-bottom:10px;
      animation:lglow 2s ease-in-out infinite alternate;
    }
    @keyframes lglow{
      from{text-shadow:0 0 8px rgba(201,168,76,.4)}
      to{text-shadow:0 0 30px rgba(201,168,76,.95),0 0 60px rgba(201,168,76,.4)}
    }
    .loading-sub{font-size:12px;color:var(--light-brown);letter-spacing:3px;opacity:.9}
    .incense-row{display:flex;gap:14px;align-items:flex-end;margin-top:32px;height:72px}
    .stick{display:flex;flex-direction:column;align-items:center}
    .smoke{width:2px;height:18px;background:linear-gradient(to bottom,transparent,rgba(201,168,76,.55));border-radius:2px;animation:smokeUp 2s ease-in-out infinite;transform-origin:bottom center}
    .stick:nth-child(2) .smoke{animation-delay:.5s}
    .stick:nth-child(3) .smoke{animation-delay:1s}
    @keyframes smokeUp{0%{height:4px;opacity:.8;transform:scaleX(1)}60%{height:26px;opacity:.4;transform:scaleX(1.8)}100%{height:4px;opacity:0;transform:scaleX(.5)}}
    .rod{width:3px;height:46px;background:linear-gradient(to bottom,#8b4513,#d2691e,var(--gold));border-radius:2px}
    .base{width:10px;height:5px;background:var(--gold-dark);border-radius:2px}
    /* Loading åº•éƒ¨å­—æ¨£ */
    .loading-brand{position:absolute;bottom:30px;font-family:'Noto Serif TC',serif;font-size:13px;color:var(--gold);letter-spacing:2px;opacity:0.6}

    #main-content{display:flex;flex-direction:column;min-height:100vh}

    /* Part 1 (é»‘åº•å€å¡Š) */
    #part1{
      flex:1;min-height:50vh;display:flex;flex-direction:column;
      background:linear-gradient(180deg,#1a0f00,#2d1a00);
      position:relative;overflow:hidden;
      padding-top: 10px; 
      padding-bottom: 10px;
    }
    #part1::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}

    /* 1A IG */
    #ig-section{
      flex:none; 
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:8px 15px 20px; 
      position:relative;overflow:hidden;
    }
    .ig-glow{position:absolute;inset:0;background:radial-gradient(ellipse at 50% 30%,rgba(201,168,76,.06),transparent 65%);pointer-events:none}
    .ig-ld{position:absolute;width:80px;height:80px;opacity:.07}
    .ig-tl{top:-8px;left:-8px;transform:rotate(40deg)}
    .ig-tr{top:-8px;right:-8px;transform:rotate(-40deg)}
    .ig-card{
      background:linear-gradient(135deg,rgba(255,255,255,.05),rgba(201,168,76,.08));
      border:1px solid rgba(201,168,76,.25);border-radius:20px;padding:18px 16px;
      width:100%;max-width:360px;display:flex;flex-direction:column;align-items:center;
      gap:14px;backdrop-filter:blur(10px);position:relative;z-index:1;box-shadow:0 8px 32px rgba(0,0,0,.4);
    }
    .ig-header{display:flex;align-items:center;gap:14px;width:100%}
    .ig-ring{width:68px;height:68px;border-radius:50%;flex-shrink:0;background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);padding:3px;display:flex;align-items:center;justify-content:center}
    .ig-inner{width:100%;height:100%;border-radius:50%;background:var(--deep-brown);border:2px solid var(--bg-dark);display:flex;align-items:center;justify-content:center;overflow:hidden;font-size:26px}
    .ig-inner img{width:100%;height:100%;object-fit:cover;border-radius:50%}
    .ig-info{flex:1;min-width:0; display:flex; flex-direction:column; justify-content:center;}
    .ig-name{font-family:'Noto Serif TC',serif;font-size:19px;font-weight:700;color:var(--gold-light);letter-spacing:1px}
    .ig-handle{font-size:13px;color:var(--light-brown);margin-top:4px}
    .ig-bio{font-size:13px;color:#c8b89a;line-height:1.7;text-align:center;width:100%;padding:0 4px}
    .ig-btn{
      display:flex;align-items:center;justify-content:center;gap:8px;
      background:linear-gradient(135deg,#f09433,#dc2743 50%,#bc1888);
      color:#fff;font-family:'Noto Sans TC',sans-serif;font-size:15px;font-weight:700;
      padding:12px 0;border-radius:50px;border:none;cursor:pointer;text-decoration:none;
      letter-spacing:2px;width:100%;box-shadow:0 4px 14px rgba(220,39,67,.4);transition:transform .2s;
    }
    .ig-btn:active{transform:scale(.97)}
    .ig-btn svg{width:18px;height:18px;fill:#fff}

    /* Marquee (1B) */
    #marquee-section{
      flex:none;
      min-height:38px;
      background:linear-gradient(90deg,rgba(201,168,76,.14),rgba(201,168,76,.07) 50%,rgba(201,168,76,.14));
      border-top:1px solid rgba(201,168,76,.2);border-bottom:1px solid rgba(201,168,76,.2);
      display:flex;align-items:center;overflow:hidden;
      margin-bottom: 25px; 
    }
    .mq-tag{flex-shrink:0;background:var(--gold);color:var(--deep-brown);font-size:12px;font-weight:700;padding:6px 12px;letter-spacing:1px;white-space:nowrap;z-index:2}
    .mq-track{flex:1;overflow:hidden}
    .mq-inner{display:flex;white-space:nowrap;animation:mqScroll 30s linear infinite}
    .mq-inner:hover{animation-play-state:paused}
    @keyframes mqScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
    .mq-item{display:inline-flex;align-items:center;padding:0 22px;font-size:12px;color:#e8d5a0;gap:6px}
    .mq-title{font-weight:700;color:var(--gold-light)}
    .mq-sep{display:inline-block;margin:0 14px;color:var(--gold);opacity:.5}

    /* Poster (1C) - æ”¾å¤§æµ·å ±ï¼Œæ¸›å°‘ç•™ç™½ */
    #poster-section{
      flex:none; 
      position:relative;
      /* å·¦å³ç•™ç™½ç¸®å°åˆ° 10pxï¼Œä¸‹æ–¹ç•™ç™½ 15px */
      padding: 0 8px 8px; 
    }
    #poster-slider {
      width: 100%;
      /* é«˜åº¦åŠ é«˜åˆ° 280px */
      height: 220px; 
      position: relative;
      border-radius: 12px; 
      overflow: hidden; 
      box-shadow: 0 6px 20px rgba(0,0,0,0.5); 
      background: #1a0f00;
    }
    .poster-slide{position:absolute;inset:0;opacity:0;transition:opacity .8s ease}
    .poster-slide.active{opacity:1}
    .poster-slide img{width:100%;height:100%;object-fit:cover;object-position:center;display:block}
    .poster-ph{width:100%;height:100%;background:linear-gradient(135deg,#1a0f00,#2d1a00);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px}
    .poster-ph-icon{font-size:36px;opacity:.3}
    .poster-ph-txt{font-size:12px;color:var(--medium-brown)}
    
    .poster-dots{
      position:absolute;
      /* é…åˆæ–°çš„ padding èª¿æ•´é»é»çš„é«˜åº¦ */
      bottom: 25px; 
      left:50%;transform:translateX(-50%);display:flex;gap:6px;z-index:5
    }
    .pdot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,.6);cursor:pointer;transition:all .3s; box-shadow: 0 1px 3px rgba(0,0,0,0.8);}
    .pdot.active{background:var(--gold);width:18px;border-radius:3px}
    
    .poster-fade{
      position:absolute;
      bottom:0; left:0; right:0;
      height:55px;
      background:linear-gradient(transparent, rgba(26,15,0,.75));
      pointer-events:none;
      z-index:4;
    }

    /* Divider */
    #divider{
      height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);
      position:relative;z-index:2;
      margin-top: 10px;
    }
    #divider::before{content:'â˜¸';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--cream);color:var(--gold);font-size:16px;padding:0 8px;line-height:1}

    /* Part 2 Bookshelf */
    #part2{
      flex:1;min-height:50vh;background:linear-gradient(180deg,#fdf5e6,#f5e8d0);
      display:flex;flex-direction:column;overflow:hidden;
      padding-top: 15px; 
    }
    .shelf-hdr{background:linear-gradient(135deg,var(--deep-brown),var(--medium-brown));padding:15px 16px 12px;display:flex;align-items:center;justify-content:center;gap:12px;flex-shrink:0;position:relative}
    .shelf-hdr::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
    .shelf-title{font-family:'Noto Serif TC',serif;font-size:20px;font-weight:900;color:var(--gold-light);letter-spacing:3px;text-shadow:0 2px 8px rgba(0,0,0,.5)}
    .shelf-scroll{flex:1;overflow-y:auto;padding:15px 0 30px;-webkit-overflow-scrolling:touch}
    .shelf-scroll::-webkit-scrollbar{display:none}
    .shelf-row{padding:10px 12px 0} 
    .books-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px 12px;padding:4px}
    .shelf-plank{height:14px;margin:4px 0 25px;background:linear-gradient(180deg,#8B5E3C,#6B4423 40%,#5a3820 60%,#8B5E3C);border-radius:2px;box-shadow:0 4px 8px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.15);position:relative;overflow:hidden}
    .shelf-plank::after{content:'';position:absolute;inset:0;background:repeating-linear-gradient(90deg,transparent,transparent 38px,rgba(0,0,0,.06) 38px,rgba(0,0,0,.06) 40px)}
    
    .book-item{display:flex;flex-direction:column;align-items:center;cursor:pointer;text-decoration:none;-webkit-tap-highlight-color:transparent;transition:transform .2s;min-height:130px; vertical-align:top;}
    .book-item:active{transform:scale(.93)}
    .book-item.empty{pointer-events:none;min-height:130px;visibility:hidden}
    .book-cover{width:100%;aspect-ratio:3/4;border-radius:4px 8px 8px 4px;overflow:hidden;position:relative;box-shadow:3px 3px 8px rgba(0,0,0,.3),-1px 0 0 rgba(0,0,0,.2),inset -3px 0 6px rgba(0,0,0,.15);background:#eee}
    .book-cover::before{content:'';position:absolute;left:0;top:0;bottom:0;width:7px;background:linear-gradient(90deg,rgba(0,0,0,.3),transparent);z-index:2}
    .book-cover::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.1),transparent 50%,rgba(0,0,0,.05));z-index:3}
    .book-cover img{width:100%;height:100%;object-fit:cover;display:block}
    .book-cover-default{width:100%;height:100%;background:linear-gradient(135deg,var(--deep-brown),var(--medium-brown));display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:8px 4px}
    .book-default-icon{font-size:26px;opacity:.6}
    .book-default-title{font-family:'Noto Serif TC',serif;font-size:10px;color:var(--gold-light);text-align:center;line-height:1.4;word-break:break-all;padding:0 4px}
    
    .book-name{
      font-family:'Noto Serif TC',serif;
      font-size: 12px; 
      color:var(--deep-brown);
      text-align:center;
      margin-top: 8px; 
      line-height: 1.4;
      width:100%;
      word-break:break-word;
      white-space:normal; 
    }
    
    .book-name.is-featured {
      font-weight:900; 
    }

    .star{color:var(--gold);margin-right:2px;font-size:12px;vertical-align:baseline;}

    /* Debug */
    #dbg-btn{position:fixed;bottom:16px;right:16px;z-index:8000;width:36px;height:36px;border-radius:50%;background:rgba(61,43,31,.85);border:1px solid var(--gold);color:var(--gold);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,.4)}
    #dbg-overlay{position:fixed;inset:0;z-index:8500;background:rgba(0,0,0,.75);display:none;align-items:flex-end}
    #dbg-overlay.show{display:flex}
    #dbg-box{width:100%;max-width:var(--phone-max);margin:0 auto;background:#1a0f00;border-top:2px solid var(--gold);padding:16px;max-height:78vh;overflow-y:auto;font-family:monospace;font-size:11px;color:#e8d5a0}
    #dbg-box h3{color:var(--gold);font-size:14px;margin-bottom:12px;font-family:'Noto Serif TC',serif}
    .ds{margin-bottom:12px;border:1px solid rgba(201,168,76,.2);padding:8px;border-radius:6px}
    .ds h4{color:var(--gold-light);margin-bottom:6px;font-size:12px}
    .dok{color:#4caf50}.dfail{color:#f44336}
    .dcols{background:rgba(255,255,255,.05);padding:6px;border-radius:4px;margin:4px 0;line-height:2;word-break:break-all}
    .dbtn-close{width:100%;background:var(--gold);color:var(--deep-brown);border:none;padding:10px;font-weight:700;font-size:14px;border-radius:6px;margin-top:12px;cursor:pointer}
    @media(min-width:431px){body::after{content:'ğŸª·';position:fixed;font-size:200px;opacity:.025;top:50%;left:15%;transform:translateY(-50%);pointer-events:none;z-index:0}}
  </style>
</head>

<body>
  <!-- LOADING -->
  <div id="loading-screen">
    <svg class="lotus-spin" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <defs><radialGradient id="lg" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#f0d080"/><stop offset="100%" stop-color="#c9a84c"/></radialGradient></defs>
      <g transform="translate(50,50)">
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(0) translate(0,-23)" opacity=".9"/>
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(45) translate(0,-23)" opacity=".8"/>
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(90) translate(0,-23)" opacity=".9"/>
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(135) translate(0,-23)" opacity=".8"/>
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(180) translate(0,-23)" opacity=".9"/>
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(225) translate(0,-23)" opacity=".8"/>
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(270) translate(0,-23)" opacity=".9"/>
        <ellipse fill="url(#lg)" rx="8" ry="20" transform="rotate(315) translate(0,-23)" opacity=".8"/>
        <circle fill="#c9a84c" r="10"/><circle fill="#f0d080" r="6"/>
      </g>
    </svg>
    <div class="loading-mantra">å—ç„¡é˜¿å½Œé™€ä½›</div>
    <div class="loading-sub" id="loading-sub">æ­£åœ¨è®€å–è³‡æ–™ï¼Œè«‹ç¨å€™â€¦</div>
    <div class="incense-row">
      <div class="stick"><div class="smoke"></div><div class="rod"></div><div class="base"></div></div>
      <div class="stick"><div class="smoke"></div><div class="rod"></div><div class="base"></div></div>
      <div class="stick"><div class="smoke"></div><div class="rod"></div><div class="base"></div></div>
    </div>
    <!-- åŠ å…¥å°ˆå±¬ç½²å -->
    <div class="loading-brand">æ›‰ Â· ç™’ Bloomie</div>
  </div>

  <!-- APP -->
  <div id="app">
    <div id="main-content">
      <div id="part1">
        <!-- 1A IG -->
        <div id="ig-section">
          <div class="ig-glow"></div>
          <svg class="ig-ld ig-tl" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><g transform="translate(40,40)" fill="#c9a84c"><ellipse rx="5" ry="14" transform="rotate(0) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(60) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(120) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(180) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(240) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(300) translate(0,-17)"/></g></svg>
          <svg class="ig-ld ig-tr" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg"><g transform="translate(40,40)" fill="#c9a84c"><ellipse rx="5" ry="14" transform="rotate(0) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(60) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(120) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(180) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(240) translate(0,-17)"/><ellipse rx="5" ry="14" transform="rotate(300) translate(0,-17)"/></g></svg>
          <div class="ig-card">
            <div class="ig-header">
              <div class="ig-ring">
                <div class="ig-inner">
                  <!-- æ›¿æ›ç‚ºä½ çš„ Instagram åœ–ç‰‡ç¶²å€ -->
                  <img src="https://scontent.cdninstagram.com/v/t51.82787-19/565050954_18005671040812584_4378769707344878195_n.jpg?stp=dst-jpg_s150x150_tt6&amp;_nc_cat=107&amp;ccb=7-5&amp;_nc_sid=f7ccc5&amp;efg=eyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLnd3dy4xMDgwLkMzIn0%3D&amp;_nc_ohc=5jD-VBMKw_0Q7kNvwHSd8v1&amp;_nc_oc=Adkpngxbvygdb1y-UM4krxxho_JKvIWnE-xii_9amDPDHVgA4emPtpcKD57SCab40HA&amp;_nc_zt=24&amp;_nc_ht=scontent.cdninstagram.com&amp;_nc_gid=yJtSF1XmvL39DC3GglgjQA&amp;oh=00_AftbDi1Bz6plY5fq9Gx0pUaJuHaOAQbMCB5zYfY-wquNBw&amp;oe=699DE696" alt="bloomie_hk" onerror="this.style.display='none';this.parentElement.textContent='ğŸŒ¸'"/>
                </div>
              </div>
              <div class="ig-info">
                <div class="ig-name">æ›‰ Â· ç™’ Bloomie</div>
                <div class="ig-handle">@bloomie_hk</div>
              </div>
            </div>
            <div class="ig-bio">ä¸€å€‹90'så­¸ä½›æ’æ¿æ—¥è¨˜ ğŸƒ<br>åœ¨æ—¥å¸¸ä¸­æ’æ¿ï¼Œåœ¨æ’æ¿ä¸­å­¸ä½› â˜€ï¸ ç°¡å–®åˆ†äº« åˆ†äº«ç°¡å–® <br> Monâ€“Fri 7am-8am / Sat 9am-10am ç›´æ’­è®€ç¶“å…±ä¿®</div>
            <a class="ig-btn" href="https://www.instagram.com/bloomie_hk" target="_blank" rel="noopener">
              <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
              å‰å¾€ Instagram
            </a>
          </div>
        </div>

        <!-- 1B Marquee -->
        <div id="marquee-section">
          <div class="mq-tag">ğŸ“¢ å…¬å‘Š</div>
          <div class="mq-track">
            <div class="mq-inner" id="mq-inner">
              <span class="mq-item"><span class="mq-title">è¼‰å…¥ä¸­</span><span>æ­£åœ¨ç²å–å…¬å‘Šâ€¦</span></span>
            </div>
          </div>
        </div>

        <!-- 1C Poster -->
        <div id="poster-section">
          <div id="poster-slider">
            <div class="poster-slide active"><div class="poster-ph"><div class="poster-ph-icon">ğŸª·</div><div class="poster-ph-txt">æ­£åœ¨è¼‰å…¥æµ·å ±â€¦</div></div></div>
          </div>
          <div class="poster-dots" id="poster-dots"></div>
        </div>
      </div>

      <div id="divider"></div>

      <!-- Part 2 Bookshelf -->
      <div id="part2">
        <div class="shelf-hdr">
          <span style="font-size:19px">ğŸ“¿</span><span class="shelf-title">ç¶“æ–‡æ›¸æ«ƒ</span><span style="font-size:19px">ğŸ“¿</span>
        </div>
        <div class="shelf-scroll" id="shelf-scroll">
          <div style="text-align:center;padding:40px 20px;color:#999;font-size:13px"><div style="font-size:32px;margin-bottom:12px">ğŸª·</div>è¼‰å…¥æ›¸æ«ƒä¸­â€¦</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Debug -->
  <div id="dbg-btn" onclick="openDbg()">ğŸ”</div>
  <div id="dbg-overlay" onclick="if(event.target===this)closeDbg()">
    <div id="dbg-box">
      <h3>ğŸ” é™¤éŒ¯é¢æ¿</h3>
      <div id="dbg-content">è¼‰å…¥ä¸­â€¦</div>
      <button class="dbtn-close" onclick="closeDbg()">é—œé–‰</button>
    </div>
  </div>

<script>
const URLS = {
  bookshelf: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTTgire2J-tlwl6RD-Kgf5A-eX5URCooLsY2GYsZlzGbXl9QI3dR53DmLO2UCC0JK8lx4FCwTDmMn0c/pub?gid=0&single=true&output=csv",
  marquee:   "https://docs.google.com/spreadsheets/d/e/2PACX-1vTTgire2J-tlwl6RD-Kgf5A-eX5URCooLsY2GYsZlzGbXl9QI3dR53DmLO2UCC0JK8lx4FCwTDmMn0c/pub?gid=1236299558&single=true&output=csv",
  poster:    "https://docs.google.com/spreadsheets/d/e/2PACX-1vTTgire2J-tlwl6RD-Kgf5A-eX5URCooLsY2GYsZlzGbXl9QI3dR53DmLO2UCC0JK8lx4FCwTDmMn0c/pub?gid=1507389389&single=true&output=csv"
};

const DBG = {}; 
function setLoadingText(t){ document.getElementById('loading-sub').textContent = t; }
function esc(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function normKey(k){
  if (k == null) return '';
  return String(k).replace(/^\uFEFF/, '').replace(/\u3000/g, ' ').replace(/\s+/g, ' ').trim().toLowerCase();
}
function buildHeaderMap(fields){
  const m = new Map();
  (fields||[]).forEach(f=>{
    const nk = normKey(f);
    if (!m.has(nk)) m.set(nk, f);
  });
  return m;
}
function getCell(row, headerMap, candidates){
  for (const c of candidates){
    const key = headerMap.get(normKey(c));
    if (key && row[key] != null && String(row[key]).trim() !== '') return String(row[key]).trim();
  }
  const keys = Object.keys(row||{});
  const nkSet = new Set(candidates.map(normKey));
  for (const k of keys){
    if (nkSet.has(normKey(k)) && row[k] != null && String(row[k]).trim() !== '') return String(row[k]).trim();
  }
  return '';
}
function truthy(v){
  const s = String(v ?? '').trim().toLowerCase();
  return v === true || v === 1 || ['true','1','yes','y','æ˜¯','æ¨è–¦','é‡ç‚¹','é‡é»','âœ“','â­','star'].includes(s);
}

/* ============================
   Fetch API
   ============================ */
async function fetchCSV(label, url){
  DBG[label] = { url, status:'loading', cols:[], count:0, sample:null, error:null };
  let text = '';

  const cacheBuster = '&_t=' + new Date().getTime();
  const directUrl = url + cacheBuster;

  try {
    const resp = await fetch(directUrl);
    if (!resp.ok) throw new Error('Direct fetch HTTP ' + resp.status);
    text = await resp.text();
  } catch(e) {
    console.warn(`[${label}] å˜—è©¦ä½¿ç”¨ä»£ç†ä¼ºæœå™¨ç¹é CORS...`);
    try {
      const proxyUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(directUrl);
      const resp2 = await fetch(proxyUrl, { cache: 'no-store' });
      if (!resp2.ok) throw new Error('Proxy fetch HTTP ' + resp2.status);
      text = await resp2.text();
    } catch(e2) {
      throw new Error('ç„¡æ³•è®€å–ã€‚è«‹ç¢ºèªã€Œç™¼ä½ˆåˆ°ç¶²è·¯ã€æ™‚ï¼Œå·¦å´ä¸‹æ‹‰é¸å–®æ˜¯é¸æ“‡ã€Œæ•´ä»½æ–‡ä»¶ (Entire Document)ã€è€Œéå–®ä¸€å·¥ä½œè¡¨ï¼');
    }
  }

  const lowerText = text.trim().toLowerCase();
  if (lowerText.startsWith('<!doctype html>') || lowerText.startsWith('<html')) {
    throw new Error('è¢« Google æ“‹ä½äº†ï¼è«‹é‡æ–°ç™¼ä½ˆä¸¦ç¢ºä¿é¸äº†ã€Œé€—è™Ÿåˆ†éš”å€¼ (.csv)ã€');
  }

  const parsed = Papa.parse(text, { header:true, skipEmptyLines:true });
  const cols = parsed.meta.fields || [];
  const rows = parsed.data || [];

  DBG[label] = { url, status:'ok', cols, count:rows.length, sample:rows[0]||null, error:null };
  return { cols, rows, headerMap: buildHeaderMap(cols) };
}

/* ============================
   Marquee
   ============================ */
async function initMarquee(){
  try{
    setLoadingText('æ­£åœ¨è¼‰å…¥å…¬å‘Šâ€¦');
    const { rows, headerMap } = await fetchCSV('å…¬å‘Šè·‘é¦¬ç‡ˆ', URLS.marquee);

    const ID      = ['å…¬å‘Šid','id','å…¬å‘Šç·¨è™Ÿ','ç¼–å·'];
    const TITLE   = ['å…¬å‘Šæ¨™é¡Œ','å…¬å‘Šæ ‡é¢˜','æ¨™é¡Œ','æ ‡é¢˜','title'];
    const CONTENT = ['å…¬å‘Šå…§å®¹','å…¬å‘Šå†…å®¹','å…§å®¹','å†…å®¹','content'];

    const items = rows
      .map(r => ({
        id: Number(getCell(r,headerMap,ID) || 0),
        title: getCell(r,headerMap,TITLE),
        content: getCell(r,headerMap,CONTENT)
      }))
      .filter(x => x.title || x.content)
      .sort((a,b)=>a.id-b.id);

    if (!items.length) {
      document.getElementById('mq-inner').innerHTML = `<span class="mq-item"><span class="mq-title">æš«ç„¡å…¬å‘Š</span></span>`.repeat(4);
      return;
    }

    let html = '';
    for (let rep=0; rep<2; rep++){
      items.forEach(it=>{
        html += `<span class="mq-item">`;
        if (it.title) html += `<span class="mq-title">${esc(it.title)}</span>`;
        if (it.content) html += `<span>${esc(it.content)}</span>`;
        html += `</span><span class="mq-sep">âœ¦</span>`;
      });
    }
    const el = document.getElementById('mq-inner');
    el.innerHTML = html;
    requestAnimationFrame(()=>{
      const w = el.scrollWidth/2;
      el.style.animationDuration = Math.max(10, w/120) + 's';
    });
  } catch(e){
    DBG['å…¬å‘Šè·‘é¦¬ç‡ˆ'] = DBG['å…¬å‘Šè·‘é¦¬ç‡ˆ'] || { url: URLS.marquee };
    DBG['å…¬å‘Šè·‘é¦¬ç‡ˆ'].status = 'error'; DBG['å…¬å‘Šè·‘é¦¬ç‡ˆ'].error = e.message;
    document.getElementById('mq-inner').innerHTML = `<span class="mq-item"><span class="mq-title">å…¬å‘Šè¼‰å…¥å¤±æ•—ï¼ˆæŒ‰ ğŸ” æŸ¥çœ‹ï¼‰</span></span>`.repeat(4);
  }
}

/* ============================
   Posters
   ============================ */
let pIdx=0, pTotal=0, pTimer=null;
async function initPosters(){
  try{
    setLoadingText('æ­£åœ¨è¼‰å…¥æµ·å ±â€¦');
    const { rows, headerMap } = await fetchCSV('æµ·å ±', URLS.poster);

    const PID = ['æµ·å ±id','æµ·æŠ¥id','id'];
    const PLINK = ['æµ·å ±åœ–ç‰‡åœ°å€','æµ·æŠ¥å›¾ç‰‡åœ°å€','æµ·å ±link','æµ·æŠ¥link','æµ·å ±é€£çµ','æµ·æŠ¥è¿ç»“','æµ·å ±éˆæ¥','æµ·æŠ¥é“¾æ¥','link','url','åœ–ç‰‡','å›¾ç‰‡'];

    const posters = rows
      .map(r => ({
        id: Number(getCell(r,headerMap,PID) || 0),
        url: getCell(r,headerMap,PLINK)
      }))
      .filter(x => x.url)
      .sort((a,b)=>a.id-b.id);

    if (!posters.length) return;
    pTotal = posters.length;

    const slider = document.getElementById('poster-slider');
    const dotsEl = document.getElementById('poster-dots');
    slider.innerHTML = ''; dotsEl.innerHTML = '';

    posters.forEach((p,i)=>{
      const slide = document.createElement('div');
      slide.className = 'poster-slide' + (i===0?' active':'');
      const img = document.createElement('img');
      img.src = p.url; img.alt = `æµ·å ± ${i+1}`; img.loading = 'lazy';
      img.onerror = function(){ this.parentElement.innerHTML = `<div class="poster-ph"><div class="poster-ph-icon">ğŸª·</div><div class="poster-ph-txt">åœ–ç‰‡è¼‰å…¥å¤±æ•—</div></div>`; };
      slide.appendChild(img); slider.appendChild(slide);

      const dot = document.createElement('div');
      dot.className = 'pdot' + (i===0?' active':'');
      dot.onclick = ()=>goSlide(i);
      dotsEl.appendChild(dot);
    });

    const fade = document.createElement('div'); fade.className = 'poster-fade'; slider.appendChild(fade);
    if (pTotal>1) pTimer = setInterval(()=>goSlide((pIdx+1)%pTotal), 4000);
  } catch(e){
    DBG['æµ·å ±'] = DBG['æµ·å ±'] || { url: URLS.poster };
    DBG['æµ·å ±'].status = 'error'; DBG['æµ·å ±'].error = e.message;
  }
}

function goSlide(idx){
  document.querySelectorAll('.poster-slide').forEach((s,i)=>s.classList.toggle('active', i===idx));
  document.querySelectorAll('.pdot').forEach((d,i)=>d.classList.toggle('active', i===idx));
  pIdx=idx;
}

let tsX=0;
document.addEventListener('DOMContentLoaded', ()=>{
  const sec = document.getElementById('poster-section');
  sec.addEventListener('touchstart', e=>tsX=e.touches[0].clientX, {passive:true});
  sec.addEventListener('touchend', e=>{
    if(!pTotal) return;
    const dx = e.changedTouches[0].clientX - tsX;
    if(Math.abs(dx)>40){
      goSlide(dx<0 ? (pIdx+1)%pTotal : (pIdx-1+pTotal)%pTotal);
      if(pTimer){ clearInterval(pTimer); pTimer=setInterval(()=>goSlide((pIdx+1)%pTotal), 4000); }
    }
  }, {passive:true});
});

/* ============================
   Bookshelf
   ============================ */
function defCover(title){
  const d=document.createElement('div'); d.className='book-cover-default';
  d.innerHTML=`<div class="book-default-icon">ğŸ“–</div>${title?`<div class="book-default-title">${esc(title)}</div>`:''}`;
  return d;
}
function emptySlot(){ const d=document.createElement('div'); d.className='book-item empty'; return d; }
function noDataMsg(msg){
  return `<div style="text-align:center;padding:40px 20px;color:#999;font-size:13px;line-height:1.6"><div style="font-size:32px;margin-bottom:12px">ğŸ™</div>${esc(msg)}</div>`;
}

async function initBookshelf(){
  const container = document.getElementById('shelf-scroll');
  try{
    setLoadingText('æ­£åœ¨è¼‰å…¥ç¶“æ–‡æ›¸æ«ƒâ€¦');
    const { rows, headerMap } = await fetchCSV('ç¶“æ–‡æ›¸æ«ƒ', URLS.bookshelf);

    const BID    = ['ç¶“æ–‡id','ç»æ–‡id','id','ç·¨è™Ÿ','ç¼–å·'];
    const BNAME  = ['ç¶“æ–‡åå­—','ç»æ–‡åå­—','ç¶“æ–‡åç¨±','ç»æ–‡åç§°','åå­—','åç¨±','ä¹¦å','æ›¸å','title','name'];
    const BCOVER = ['ç¶“æ–‡å°é¢åœ–ç‰‡åœ°å€','ç»æ–‡å°é¢å›¾ç‰‡åœ°å€','ç¶“æ–‡å°é¢åœ–ç‰‡','å°é¢åœ–ç‰‡','å°é¢å›¾ç‰‡','å°é¢','cover','image','åœ–ç‰‡','å›¾ç‰‡'];
    const BLINK  = ['ç¶“æ–‡ä¸‹è¼‰éˆæ¥','ç¶“æ–‡ä¸‹è¼‰é€£çµ','ç»æ–‡ä¸‹è½½é“¾æ¥','ä¸‹è½½é“¾æ¥','ä¸‹è¼‰éˆæ¥','ä¸‹è¼‰é€£çµ','éˆæ¥','è¿ç»“','é€£çµ','link','url'];
    const BSTAR  = ['æ˜¯å¦é‡é»æ¨è–¦','æ˜¯å¦é‡ç‚¹æ¨è','é‡é»æ¨è–¦','é‡ç‚¹æ¨è','æ¨è–¦','æ¨è','featured','star','â­'];

    const books = rows
      .map(r => ({
        idRaw: getCell(r,headerMap,BID),
        id: Number(getCell(r,headerMap,BID) || NaN),
        name: getCell(r,headerMap,BNAME),
        cover: getCell(r,headerMap,BCOVER),
        link: getCell(r,headerMap,BLINK),
        star: truthy(getCell(r,headerMap,BSTAR))
      }))
      .filter(b => b.idRaw !== ''); 

    const anyId = books.some(b => !Number.isNaN(b.id));
    if (!anyId) { container.innerHTML = noDataMsg('è®€å–æˆåŠŸï¼Œä½†æ‰¾ä¸åˆ°ã€Œç¶“æ–‡IDã€æ¬„ä½ï¼Œè«‹æŒ‰ ğŸ” ç¢ºèª'); return; }

    books.sort((a,b)=> (Number.isNaN(a.id)?999999:a.id) - (Number.isNaN(b.id)?999999:b.id));

    const normalized = books.map(b=>{
      const hasAny = (b.name || b.cover || b.link);
      if (!hasAny && !Number.isNaN(b.id)) return { empty:true };
      return { ...b, empty:false };
    });

    const chunks = [];
    for (let i=0;i<normalized.length;i+=3) chunks.push(normalized.slice(i,i+3));
    container.innerHTML = '';

    chunks.forEach(chunk=>{
      while(chunk.length<3) chunk.push({empty:true});
      const rowEl=document.createElement('div'); rowEl.className='shelf-row';
      const grid=document.createElement('div'); grid.className='books-grid';

      chunk.forEach(b=>{
        if (b.empty) { grid.appendChild(emptySlot()); return; }
        const el=document.createElement(b.link ? 'a' : 'div');
        el.className='book-item';
        if (b.link) { el.href=b.link; el.target='_blank'; el.rel='noopener'; }

        el.addEventListener('click', function(){
          const cw=this.querySelector('.book-cover'); if(!cw)return;
          const rip=document.createElement('span');
          rip.style.cssText='position:absolute;left:50%;top:50%;width:0;height:0;background:rgba(201,168,76,.45);border-radius:50%;animation:ripA .6s ease forwards;pointer-events:none;z-index:10;transform:translate(-50%,-50%)';
          cw.appendChild(rip); setTimeout(()=>rip.remove(),700);
        });

        const cw=document.createElement('div'); cw.className='book-cover';
        if (b.cover) {
          const img=document.createElement('img');
          img.src=b.cover; img.alt=b.name||''; img.loading='lazy';
          img.onerror=function(){ this.replaceWith(defCover(b.name)); };
          cw.appendChild(img);
        } else {
          cw.appendChild(defCover(b.name));
        }
        el.appendChild(cw);

        if (b.name) {
          const nm=document.createElement('div'); 
          nm.className='book-name' + (b.star ? ' is-featured' : '');
          nm.innerHTML = (b.star ? '<span class="star">â˜…</span>' : '') + esc(b.name);
          el.appendChild(nm);
        }
        grid.appendChild(el);
      });
      rowEl.appendChild(grid);
      const plank=document.createElement('div'); plank.className='shelf-plank';
      rowEl.appendChild(plank);
      container.appendChild(rowEl);
    });

  } catch(e){
    DBG['ç¶“æ–‡æ›¸æ«ƒ'] = DBG['ç¶“æ–‡æ›¸æ«ƒ'] || { url: URLS.bookshelf };
    DBG['ç¶“æ–‡æ›¸æ«ƒ'].status = 'error'; DBG['ç¶“æ–‡æ›¸æ«ƒ'].error = e.message;
    container.innerHTML = noDataMsg('æ›¸æ«ƒè¼‰å…¥å¤±æ•—ï¼ˆæŒ‰å³ä¸‹è§’ ğŸ” æŸ¥çœ‹åŸå› ï¼‰');
  }
}

/* ============================
   Debug panel
   ============================ */
function openDbg(){
  const box = document.getElementById('dbg-content');
  const order = ['å…¬å‘Šè·‘é¦¬ç‡ˆ','æµ·å ±','ç¶“æ–‡æ›¸æ«ƒ'];
  let html='';
  order.forEach(name=>{
    const d = DBG[name];
    if(!d){ html += `<div class="ds"><h4>${name}</h4><div class="dfail">å°šæœªè¼‰å…¥</div></div>`; return; }
    const ok = d.status === 'ok';
    html += `<div class="ds">
      <h4>${ok?'âœ…':'âŒ'} ${name}</h4>
      <div>ç‹€æ…‹: <span class="${ok?'dok':'dfail'}">${esc(d.status)}</span></div>`;
    if(d.error) html += `<div style="color:#ff9999;margin-top:4px;word-break:break-all">éŒ¯èª¤åŸå› :<br>${esc(d.error)}</div>`;
    if(d.cols && d.cols.length) html += `<div style="margin-top:6px;color:#aaa">è§£æåˆ°çš„æ¬„ä½åç¨±:</div>
      <div class="dcols">${d.cols.map((c,i)=>`[${i}] "${esc(c)}"`).join('<br>')}</div>`;
    if(d.sample) html += `<div style="margin-top:4px;color:#aaa">ç¬¬ä¸€è¡Œè³‡æ–™:</div>
      <div class="dcols" style="font-size:10px">${esc(JSON.stringify(d.sample))}</div>`;
    html += `</div>`;
  });
  box.innerHTML = html || 'æ²’æœ‰è³‡æ–™';
  document.getElementById('dbg-overlay').classList.add('show');
}
function closeDbg(){ document.getElementById('dbg-overlay').classList.remove('show'); }

const rs=document.createElement('style');
rs.textContent='@keyframes ripA{from{width:0;height:0;opacity:1}to{width:110px;height:110px;opacity:0}}';
document.head.appendChild(rs);

/* ============================
   Boot
   ============================ */
async function boot(){
  try{ await Promise.allSettled([initMarquee(), initPosters(), initBookshelf()]); } 
  finally {
    const loader=document.getElementById('loading-screen');
    loader.classList.add('fade-out');
    setTimeout(()=>loader.remove(), 950);
  }
}
document.addEventListener('DOMContentLoaded',()=>setTimeout(boot,400));
</script>
</body>
</html>








